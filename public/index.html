<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
	<script>window.APP_VERSION = 'v1.0.2.1';</script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HandinCap - Your Handicap in Hand</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Just a ScoreCard">
    <meta name="theme-color" content="#16a34a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HandinCap">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/logo192.png">
    <link rel="apple-touch-icon" href="/logo192.png">
    
    <!-- Original Scripts -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ‚úÖ Babel ÂøÖÈ°ªÂú® type="text/babel" ÁöÑ script ‰πãÂâçÂä†ËΩΩ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
      // ‚úÖ ‰øÆÂ§ç decorators plugin Êä•Èîô
      Babel.registerPreset('custom', {
        presets: [
          [Babel.availablePresets['react']],
          [Babel.availablePresets['stage-3'], { decoratorsBeforeExport: true }]
        ]
      });
    </script>
</head>
<body>
    <div id="root"></div>

    <!-- ‚úÖ ‰ΩøÁî® custom preset Ëß£ÂÜ≥ decorators Êä•Èîô -->
    <!-- ‚úÖ PWA ÂÆâË£ÖÊèêÁ§∫Â∑≤ÂÜÖÁΩÆÂú® IntegratedGolfGame.js ÁöÑ PWAInstallPrompt ÁªÑ‰ª∂‰∏≠ -->
    <script type="text/babel" data-presets="custom" src="/IntegratedGolfGame.js"></script>
    
    <!-- Register Service Worker with Update Detection -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('SW registered:', registration.scope);
              
              // Ê£ÄÊµãÂà∞Êñ∞ÁâàÊú¨Ê≠£Âú®ÂÆâË£Ö
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                console.log('New SW installing...');
                
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'activated') {
                    // Êñ∞ÁâàÊú¨Â∑≤ÊøÄÊ¥ª
                    console.log('New SW activated!');
                    
                    // ÊòæÁ§∫Êõ¥Êñ∞ÊèêÁ§∫
                    const lang = localStorage.getItem('handincap_lang') || 'en';
                    const msg = lang === 'zh' 
                      ? 'üéâ ÂèëÁé∞Êñ∞ÁâàÊú¨ÔºÅÁÇπÂáªÁ°ÆÂÆöÂà∑Êñ∞È°µÈù¢Âä†ËΩΩÊúÄÊñ∞ÁâàÊú¨'
                      : 'üéâ New version available! Click OK to refresh and load the latest version';
                    if (confirm(msg)) {
                      window.location.reload();
                    }
                  }
                });
              });
              
              // ÊØèÊ¨°ÊâìÂºÄÈ°µÈù¢Ê£ÄÊü•Êõ¥Êñ∞
              registration.update();
            })
            .catch((error) => {
              console.log('SW registration failed:', error);
            });
        });
        
        // üî¥ ÁõëÂê¨SWÊé•ÁÆ°‰∫ã‰ª∂ÔºåËá™Âä®Âà∑Êñ∞
        let refreshing = false;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          if (!refreshing) {
            refreshing = true;
            console.log('Controller changed, reloading...');
            window.location.reload();
          }
        });
      }
    </script>
</body>
</html>
